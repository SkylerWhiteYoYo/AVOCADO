package newproject;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;


public class MysqlConnection {
	private static final String DB_DRIVER = "com.mysql.cj.jdbc.Driver";
	private static final String DB_URL = "jdbc:mysql://new-db.crnbwzhpnodx.ap-northeast-2.rds.amazonaws.com/newdb";
	private static final String DB_USERNAME = "admin";
	private static final String DB_PASSWORD = "OOPproject_10";
			
	public static Connection getConnection(){
		Connection conn = null;
		try{
			//Register the JDBC driver
			Class.forName(DB_DRIVER);
 
			//Open the connection
			conn = DriverManager.getConnection(DB_URL, DB_USERNAME, DB_PASSWORD);
 
			if(conn != null){
			   System.out.println("Successfully connected.");
			}else{
			   System.out.println("Failed to connect.");
			}
		}catch(Exception e){
			e.printStackTrace();
		}
		return conn;
	}
	
	//테이블 보기
	public void viewTable(String table) {// table 변수 ->all(전체보기),user,note_list,friend,mynote,vasicvoca
		PreparedStatement preparedStatement = null;
		String sql = null;
		ResultSet rs = null;
		
		try {
			Connection conn = MysqlConnection.getConnection();
			
			if(table.equals("user") || table.equals("all")) {
				sql = "SELECT * FROM user;";
				preparedStatement = conn.prepareStatement(sql);
				rs = preparedStatement.executeQuery();
				
				System.out.println("user_id\tnickname");
				
				while(rs.next()) {
					String user_id = rs.getString("user_id");
					String nickname = rs.getString("nickname");
					System.out.println(user_id + " \t" + nickname);
				}
			}
				
			if(table.equals("friend") || table.equals("all")) {
				System.out.println("");
				sql = "SELECT * FROM friend;";
				preparedStatement = conn.prepareStatement(sql);
				rs = preparedStatement.executeQuery();
				
				System.out.println("my_id\tfriend_nickname");
				while(rs.next()) {
					String my_id = rs.getString("my_id");
					String friend_nickname= rs.getString("friend_nickname");
					System.out.println(my_id + "\t" + friend_nickname);
				}
			}
			
			if(table.equals("note_list") || table.equals("all")) {
				System.out.println("");
				sql = "SELECT * FROM note_list;";
				preparedStatement = conn.prepareStatement(sql);
				rs = preparedStatement.executeQuery();
				System.out.println("note_name\tuser_id");
				while(rs.next()) {
					String note_name = rs.getString("note_name");
					String user_id = rs.getString("user_id");
					System.out.println(note_name + "   \t " + user_id+ " \t" );
				}
			}
			
			
			if(table.equals("basic_voca") || table.equals("all")) {
				System.out.println("");
				sql = "SELECT * FROM basic_voca;";
				preparedStatement = conn.prepareStatement(sql);
				rs = preparedStatement.executeQuery();
				System.out.println("num\tword\tmeaning");
				while(rs.next()) {
					int num = rs.getInt("num");
					String word = rs.getString("word");
					String meaning = rs.getString("meaning");
					System.out.println(num + "\t" + word +  "\t" + meaning + "\t");
				}
			}
			
			if(table.equals("mynote") || table.equals("all")) {
				System.out.println("");
				sql = "SELECT * FROM mynote;";
				preparedStatement = conn.prepareStatement(sql);
				rs = preparedStatement.executeQuery();
				
				System.out.println("num\tuser_id\tnote_name\tword\tmeaning");
				while(rs.next()) {
					int num = rs.getInt("num");
					String user_id = rs.getString("user_id");
					String note_name= rs.getString("note_name");
					String word = rs.getString("word");
					String meaning = rs.getString("meaning");
					System.out.println(num + "\t" + user_id + "\t" + note_name + " \t" + word + "\t" + meaning + "\t");
				}
			}
			
			
			
			
			preparedStatement.close();
			conn.close();
		}catch(Exception e){
			e.printStackTrace();
		
		
		}
	}
	
	//DB 테이블 생성 (웬만하면 건들지 말것)
	public void creatTable(String sql){//  ex) "CREATE table newtable(ID INT)"

			PreparedStatement preparedStatement = null;
			
			
			try {
				Connection conn = getConnection();
				preparedStatement = conn.prepareStatement(sql);
				preparedStatement.execute();
				preparedStatement.close();
				conn.close();
			}catch(Exception e){
				e.printStackTrace();
			}
			
	}
	
	//sql문으로 작동
	public void query(String sql){// ex) "Insert into Voca values(3,"+"\'grape\',"+"\'포도\')"

			PreparedStatement preparedStatement = null;
			
			try {
				Connection conn = MysqlConnection.getConnection();
				preparedStatement = conn.prepareStatement(sql);
				preparedStatement.execute();
				preparedStatement.close();
				conn.close();
			}catch(Exception e){
				e.printStackTrace();
			}
				
	}
	
	//user 테이블에 id추가
	public void userInsert(String id, String nickname) {
		PreparedStatement preparedStatement = null;
		
		String sql = "INSERT INTO user VALUES("+ "\'"+ id +"\'" +","+ "\'" + nickname +"\'"+");";
		try {
			Connection conn = MysqlConnection.getConnection();

			preparedStatement = conn.prepareStatement(sql);
			preparedStatement.execute();
			preparedStatement.close();
			conn.close();
		}catch(Exception e){
			e.printStackTrace();
		}
		
	}
	
	//mynote 테이블에 (나만의 단어장) 단어 추가
	public void noteInsert(String user_id, String note_name, String word, String meaning) {
		PreparedStatement preparedStatement = null;
		
		String sql = "SELECT MAX(num) FROM mynote;";
		try {
			
			
			Connection conn = MysqlConnection.getConnection();
			
			preparedStatement = conn.prepareStatement(sql);
			ResultSet rs = preparedStatement.executeQuery();
			rs.next();
			int num = rs.getInt("MAX(num)")+1;
			
			sql = "INSERT INTO mynote VALUES("+ "\'"+ num +"\'" +","+ "\'" + user_id +"\'"+","+"\'"+ note_name+"\'" +","+"\'"+ word +"\'" +","+"\'"+ meaning +"\'"+");";
			System.out.println(sql);
			preparedStatement = conn.prepareStatement(sql);
			preparedStatement.execute();
			preparedStatement.close();
			conn.close();
		}catch(Exception e){
			e.printStackTrace();
		}
		
	}
	
	//friend 테이블에 친구 추가
	public void friendInsert(String my_id, String friend_nickname) {
		PreparedStatement preparedStatement = null;
		
		String sql = "INSERT INTO friend VALUES("+ "\'"+ my_id +"\'" +","+ "\'" + friend_nickname +"\'"+");";
		try {
			Connection conn = MysqlConnection.getConnection();

			preparedStatement = conn.prepareStatement(sql);
			preparedStatement.execute();
			preparedStatement.close();
			conn.close();
		}catch(Exception e){
			e.printStackTrace();
		}
		
	}
	
	//단어장 추가
	public void noteListInsert(String note_name, String user_id) {
		PreparedStatement preparedStatement = null;
		
		String sql = "INSERT INTO note_list VALUES("+ "\'"+ note_name +"\'" +","+ "\'" + user_id +"\'"+");";
		try {
			Connection conn = MysqlConnection.getConnection();

			preparedStatement = conn.prepareStatement(sql);
			preparedStatement.execute();
			preparedStatement.close();
			conn.close();
		}catch(Exception e){
			e.printStackTrace();
		}
		
	}
	
	
	//번호를 이용해 mynote 테이블의 내용 수정
	public void noteUpdate(String column, String new_data, int num) {
		PreparedStatement preparedStatement = null;
		String sql = null;
		if(column.equals("word"))
			sql = "UPDATE mynote SET word =" + "\'"+new_data+"\'"+"WHERE(num = "+num +");";
		else if(column.equals("meaning"))
			sql = "UPDATE mynote SET meaning =" + "\'"+new_data+"\'"+"WHERE(num = "+num+");";
		
		try {
			Connection conn = MysqlConnection.getConnection();
			System.out.println(sql);
			preparedStatement = conn.prepareStatement(sql);
			preparedStatement.execute();
			preparedStatement.close();
			conn.close();
		}catch(Exception e){
			e.printStackTrace();
		}
		
	}
	
	
	

		
}

	
